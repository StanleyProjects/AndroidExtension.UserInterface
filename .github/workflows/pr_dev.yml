name: Pull request to dev

on:
  pull_request:
    types: [opened, reopened]
    branches:
      - dev

jobs:
  prepare:
    uses: .github/workflows/prepare.yml@build
  build:
    runs-on: ubuntu-20.04
    needs: prepare
    env:
      telegram_bot_id: ${{secrets.TELEGRAM_BOT_ID}}
      telegram_bot_token: ${{secrets.TELEGRAM_BOT_TOKEN}}
      telegram_chat_id: ${{secrets.TELEGRAM_CHAT_ID_COMMON}}
    steps:
      - run: |
          echo "PR_NUMBER        =$(jq -r .pull_request.number   $GITHUB_EVENT_PATH)" >> $GITHUB_ENV
          echo "PR_SOURCE_BRANCH =$(jq -r .pull_request.base.ref $GITHUB_EVENT_PATH)" >> $GITHUB_ENV
          echo "GIT_SOURCE_BRANCH=$(jq -r .pull_request.head.ref $GITHUB_EVENT_PATH)" >> $GITHUB_ENV
          echo "GIT_COMMIT_SHA   =$(jq -r .pull_request.head.sha $GITHUB_EVENT_PATH)" >> $GITHUB_ENV
      - working-directory: ${{env.HOME}}/repository
        run: /bin/bash $RESOURCES_PATH/bash/workflow/pr/dev/main.sh
